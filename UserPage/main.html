<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>UserPage</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/css/materialize.min.css">
	  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css" href="../UserPage/user_style.css">
    <script src="./js/pdf.js"></script>
    <script src="./js/pdf.worker.js"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<style type="text/css">

#upload-button {
	width: 150px;
	display: block;
	margin: 20px auto;
}

#file-to-upload {
	display: none;
}

#pdf-main-container {
	width: 400px;
	margin: 20px auto;
}

#pdf-loader {
	display: none;
	text-align: center;
	color: #999999;
	font-size: 13px;
	line-height: 100px;
	height: 100px;
}

#pdf-contents {
	display: none;
}

#pdf-meta {
	overflow: hidden;
	margin: 0 0 20px 0;
}

#pdf-buttons {
	float: left;
}

#page-count-container {
	float: right;
}

#pdf-current-page {
	display: inline;
}

#pdf-total-pages {
	display: inline;
}

#pdf-canvas {
	border: 1px solid rgba(0,0,0,0.2);
	box-sizing: border-box;
}

#page-loader {
	height: 100px;
	line-height: 100px;
	text-align: center;
	display: none;
	color: #999999;
	font-size: 13px;
}

</style>
  </head>
  <body>
    
      <nav id="navigationbar">
        <span class="open-slide">
            <!--Slide bar button-->
            <a href="#" onclick="openslidemenu()">
                <svg width="30" height="30">
                        <path d="M0,5 30,5" stroke="#fff" 
                        stroke-width="5"/>
                        <path d="M0,14 30,14" stroke="#fff" 
                        stroke-width="5"/>
                        <path d="M0,23 30,23" stroke="#fff" 
                        stroke-width="5"/>
                </svg>
            </a>
        </span>
            <!--Links-->
        <ul class="navbar-nav">
	    <li id='credits' style='padding-left:10px;'></li>
            <li><a href="#">How To Use</a></li>
            <li><a href="#">Credits</a></li>
            <li><a href="#">Contacts</a></li>
            <li><a href="#" id="logout">Logout</a></li>
        </ul>
    </nav>
      
      <div id="slidemenu" class="side-menu">
          <a href="#" class="close-btn" onclick="closeslidemenu()">&times;</a>
          <a href="#">How To Use</a>
          <a href="#">Credits</a>
          <a href="#">Contacts</a>
          <a href="#">Logout</a>
      </div>

	<a id='upload-button' class="waves-effect waves-light btn red" style='width:200px;'><i class="material-icons">cloud_upload</i>    Select PDF</a>
	<input type="file" id="file-to-upload" accept="application/pdf" />

<div id="pdf-main-container">
	<div id="pdf-loader">Loading document ...</div>
	<div id="pdf-contents">
		<div id="pdf-meta">
			<div id="pdf-buttons">
				<a id='pdf-prev' class="waves-effect waves-light btn"><i class="material-icons">arrow_back</i>    Previous</a>
				<a id='pdf-next' class="waves-effect waves-light btn"><i class="material-icons">arrow_forward</i>    Select PDF</a>
			</div>
		</div>
		<canvas id="pdf-canvas" width="500"></canvas>
		<div id="page-loader">Loading page ...</div>
		<font color='white' class='btn disabled'> <div id="page-count-container">Page <div id="pdf-current-page"></div> of <div id="pdf-total-pages"></div></div> </font>
	</div>
</div>
      
      
      
      <script>
	var CREDITS = 12;
	document.getElementById("credits").innerHTML = "Credits: " + CREDITS;
        function openslidemenu(){
            document.getElementById("slidemenu").style.width= '250px';
        }
        function closeslidemenu(){
            document.getElementById("slidemenu").style.width= '0px';
        }
	if(CREDITS == 0)
	{	
		window.alert("Credits: "+ CREDITS + "\nInsufficient Credits");	
		$("#upload-button").addClass("disabled");
		}
	//UPLOAD PDF + PREVIEW
		var __PDF_DOC,
	__CURRENT_PAGE,
	__TOTAL_PAGES,
	__PAGE_RENDERING_IN_PROGRESS = 0,
	__CANVAS = $('#pdf-canvas').get(0),
	__CANVAS_CTX = __CANVAS.getContext('2d');
function showPDF(pdf_url) {
	$("#pdf-loader").show();
	PDFJS.getDocument({ url: pdf_url }).then(function(pdf_doc) {
		__PDF_DOC = pdf_doc;
		__TOTAL_PAGES = __PDF_DOC.numPages;
		$("#pdf-loader").hide();
		$("#pdf-contents").show();
		$("#pdf-total-pages").text(__TOTAL_PAGES);
		showPage(1);
	}).catch(function(error) {
		$("#pdf-loader").hide();
		$("#upload-button").show();
		alert(error.message);
	});;
}
function showPage(page_no) {
	__PAGE_RENDERING_IN_PROGRESS = 1;
	__CURRENT_PAGE = page_no;
	$("#pdf-next, #pdf-prev").attr('disabled', 'disabled');
	$("#pdf-canvas").hide();
	$("#page-loader").show();
	$("#pdf-current-page").text(page_no);
	__PDF_DOC.getPage(page_no).then(function(page) {
		var scale_required = __CANVAS.width / page.getViewport(1).width;
		var viewport = page.getViewport(scale_required);
		__CANVAS.height = viewport.height;
		var renderContext = {
			canvasContext: __CANVAS_CTX,
			viewport: viewport
		};
		page.render(renderContext).then(function() {
			__PAGE_RENDERING_IN_PROGRESS = 0;
			$("#pdf-next, #pdf-prev").removeAttr('disabled');
			$("#pdf-canvas").show();
			$("#page-loader").hide();
		});
	});
}
$("#upload-button").on('click', function() {
	$("#file-to-upload").trigger('click');
});
$("#file-to-upload").on('change', function() {

    if(['application/pdf'].indexOf($("#file-to-upload").get(0).files[0].type) == -1) {
        alert('Error : Not a PDF');
        return;
    }
	$("#upload-button").hide();
	showPDF(URL.createObjectURL($("#file-to-upload").get(0).files[0]));
});
$("#pdf-prev").on('click', function() {
	if(__CURRENT_PAGE != 1)
		showPage(--__CURRENT_PAGE);
});
$("#pdf-next").on('click', function() {
	if(__CURRENT_PAGE != __TOTAL_PAGES)
		showPage(++__CURRENT_PAGE);
});      </script>
  </body>
</html>
